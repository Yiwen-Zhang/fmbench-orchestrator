# general configuration applicable to the entire app
general:
  name: llama3.1-8b-g5

aws:
  # This is the path to the hf token file that contains your custom
  # hf token
  hf_token_fpath: /tmp/hf_token.txt
  # AWS region, this parameter is templatized, no need to change
  region: {{region}}
  
# steps to run the fmbench orchestration
# test. If all steps are set to yes, the security
# group will be greated, the keys will be generated at 
# instance creation, EC2 instances will be created, 
# the FMBench orchestration test will run and then at the 
# end the infrastructure (in this case EC2 instances) will
# be deleted.
# All results are stored in the local results directory at the end of the
# FMBench orchestration test.
run_steps:
  security_group_creation: yes
  key_pair_generation: yes
  deploy_ec2_instance: yes
  create_iam_role: no
  run_bash_script: yes
  delete_ec2_instance: no

security_group:
  group_name: fmbench_orchestrator_sg
  description: MultiDeploy EC2 Security Group
  # If VPC Is left empty, boto3 automatically gets the default VPC for your region
  # If your current region does not have an active default VPC set up, set it up manually
  # following the steps here: https://docs.aws.amazon.com/vpc/latest/userguide/work-with-default-vpc.html#create-default-vpc
  vpc_id:


key_pair_gen:
  # This assumes that if key_pair_generation is false, you have the key pair stored in the root.
  # If so, change the file name to your KP name and the script will pick it up.
  key_pair_name: fmbench_orchestrator_key_pair-{{region}}

defaults: &ec2_settings
  region: {{region}}
  ami_id: {{gpu}}
  device_name: /dev/sda1
  ebs_del_on_termination: True
  ebs_Iops: 16000
  ebs_VolumeSize: 250
  ebs_VolumeType: gp3
  startup_script: startup_scripts/ubuntu_startup.txt
  post_startup_script: post_startup_scripts/fmbench.txt
  # Timeout period in Seconds before a run is stopped
  fmbench_complete_timeout: 2400
  
instances:
- instance_type: g5.xlarge
  deploy: yes
  <<: *ec2_settings
  fmbench_config: 
  - fmbench:llama3.1/8b/config-llama3.1-8b-g5.xl-tp-1-mc-max-ec2-conc-1-2.yml

- instance_type: g5.2xlarge
  deploy: yes
  <<: *ec2_settings
  fmbench_config: 
  - fmbench:llama3.1/8b/config-llama3.1-8b-g5.2xl-tp-1-mc-max-ec2-conc-1-2.yml


